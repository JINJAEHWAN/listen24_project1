<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미니 프로젝트 팀 소개</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>


    <style>
        body {
            background-color: #f7f7f7;
            font-family: 'Arial', sans-serif;
        }

        footer {
            margin-top: 100px;
            padding: 50px;

            width: 100%;
            height: fit-content;

            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: space-around;

            background-color: rgb(126, 126, 126);
            color: white;
        }

        .title-section {
            text-align: center;
            padding: 20px 0;
        }

        .title-section h1 {
            font-size: 48px;
            color: #333;
        }

        .central-image {
            text-align: center;
            padding: 20px 0;
            position: relative;
            top: -50px;
            /* Adjust this value as needed */
            z-index: 2;
        }

        .central-image p {
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .central-image img {
            max-width: 600px;
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .team-intro {
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover;
            padding: 100px 0;
            text-align: center;
            color: white;
            position: relative;
            z-index: 2;
        }

        .team-intro::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: -1;
        }

        .team-intro h1 {
            font-size: 48px;
            color: #fff;
            margin-bottom: 20px;
        }

        .team-intro p {
            font-size: 18px;
            color: #ddd;
            margin-bottom: 30px;
        }

        .btn-cheer {
            background-color: #ff4500;
            border: none;
            color: white;
            font-size: 20px;

            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out;
            margin-top: 10px;
        }

        .btn-cheer:hover {
            background-color: #e03e00;
        }

        .btn-cheer i {
            margin-right: 10px;
        }

        .cards {
            padding: 50px 0;

        }

        .click_here {
            cursor: pointer;
        }

        .card,
        .modal_card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-10px);
        }

        .card-body {
            overflow: scroll;
        }

        .card-body::-webkit-scrollbar {
            display: none;
        }

        .card-img-top {
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            height: 250px;
            object-fit: cover;
        }

        .modal_card>.card-img-top {
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }

        .modal_card>.card-body {
            max-height: 500px;
            ;
        }

        .card-title {
            text-align: center;
            font-size: 22px;
            color: #333;
            margin-bottom: 15px;
        }

        h1.card-title {
            font-size: 50px;
            font-weight: bolder;
        }

        .modal-content {
            min-width: 480px;
            width: fit-content;
            max-height: 800px;
            height: fit-content;
            border-radius: 10px;
            /* 모달 높이를 설정합니다. 필요에 따라 값 조정 */
        }

        .close_btn {
            width: 35px;
            height: 35px;

            float: right;
            margin: 4px;

            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 5px;
        }

        .list-group {
            margin: 0 auto 0 auto;

            min-width: 350px;
            width: fit-content;
        }

        .card-subtitle {
            text-align: left;
            margin-top: 10px;
            font-weight: bolder;
        }

        .list-group-item {
            padding-top: 30px;
            text-align: center;
        }

        .central-image-text:nth-child(2) {
            font-size: 25px;
        }

        #cheer_up {
            display: none;
        }
    </style>
    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";


        // 파이어베이스키 여기 붙여넣어주세요!!!
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAsW15CfXcs9pJlqa7LXbvrsnaIetWtsts",
            authDomain: "listen24-6b189.firebaseapp.com",
            projectId: "listen24-6b189",
            storageBucket: "listen24-6b189.appspot.com",
            messagingSenderId: "1058082641331",
            appId: "1:1058082641331:web:f24f9268cf90443b26a7c6",
            measurementId: "G-WB2G5NMWP5"
        };

        // Firebase 인스턴스 초기화
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();


        let member_info = db.collection('member_info');
        let background = member_info.doc('background');

        background.get().then(function (doc) {
            if (doc.exists) {
                let row = doc.data();
                let image = row['image'];

                $('.team-intro').css("background-image", `url(${image})`);
            }
        }).catch(function (error) {
            alert('Error getting document: ' + error);
        });

        // 응원 횟수 뿌리기
        let docRef = member_info.doc('cheer');
        let cheer = {};

        docRef.get().then(function (doc) {
            if (doc.exists) {
                let row = doc.data();
                let cnt = row['cnt'];
                cheer = row;

                $('#cheer-count').empty();
                $('#cheer-count').text(cnt);
            }
        }).catch(function (error) {
            alert('Error getting document: ' + error);
        });

        let keys = [];
        member_info.doc('info_keys').get().then(function (doc) {
            if (doc.exists) {
                let row = doc.data();
                keys = row['keys'];
            }
        }).catch(function (error) {
            alert('Error getting document: ' + error);
        });


        // 팀, 멤버 소개 정보 setting
        $('#card_box').empty();
        for (let n = 0; n < 6; n++) {
            let member = member_info.doc(`member${n}`);
            member.get().then(function (doc) {
                if (doc.exists) {
                    let row = doc.data();
                    let image = row['image'];
                    let name = row['name'];
                    let info = row['info'];
                    let list_group = "";
                    let col = "";

                    if (n > 0) {
                        col = `<div class="col">
                                    <div class="card click_here" data-bs-toggle="modal" data-bs-target="#member${n}_modal">
                                        <img src="${image}" class="card-img-top member${n}" alt="${name}">
                                        <div class="card-body">
                                            <h5 class="card-title">${name}</h5>
                                        </div>
                                    </div>
                                </div>`;
                        let blog = row['blog'];

                        keys.forEach(e => {
                            list_group += `<li class="list-group-item">
                                        <h6 class="card-subtitle mb-2 text-body-secondary">${e}</h6>
                                        <p class="card-text">${info[e]}</p>
                                    </li>`;
                        });

                        list_group += `<li class="list-group-item">
                                        <a href="${blog}" target="_blank">
                                            <i class="fa-solid fa-link" style="font-size: 24px; color: #333;"></i>
                                        </a>
                                    </li>`;
                    } else {
                        let temp_html = `<img src="${image}" alt="Central Image" data-bs-toggle="modal" data-bs-target="#member${n}_modal"
            class="click_here member${n}">`;

                        $('#team_intro').prepend(temp_html);

                        list_group = `<li class="list-group-item">
                                        <p class="central-image-text">${info[0]}</p>
                                    </li>
                                    <li class="list-group-item">
                                        <h4 class="card-subtitle mb-2 text-body-secondary">⭐ 의미 & 목표</h4>
                                        <p class="central-image-text">${info[1]}</p>
                                    </li>
                                    <li class="list-group-item">
                                        <p class="central-image-text">${info[2]}</p>
                                    </li>`;
                    }



                    let temp_html = `${col}
            <div class="modal fade" id="member${n}_modal" tabindex="-1" aria-labelledby="memberModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal_card">
                            <div class="card-img-top member${n}">
                                <button type="button" class="close_btn  " data-bs-dismiss="modal" aria-label="Close">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white"
                                        class="bi bi-x-lg" viewBox="0 0 16 16">
                                        <path
                                            d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                            <div class="card-body">
                                <h5 class="card-title">${name}</h5>
                                <ul class="list-group list-group-flush">
                                    ${list_group}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;

                    $('#card_box').append(temp_html);
                    $(`div.member${n}`).css("background-image", `url('${image}')`);

                }
            }).catch(function (error) {
                alert('Error getting document: ' + error);
            });
        }

        // footer setting
        member_info.doc('rules').get().then(function (doc) {
            if (doc.exists) {
                let row = doc.data();
                let rules = row['rules'];
                let time_table = row['time_table'];
                let r_li = "";
                let t_li = "";

                rules.forEach(e => {
                    r_li += `<li>${e}</li>`;
                });

                time_table.forEach(e => {
                    t_li += `<li>${e}</li>`;
                })

                let temp_html = `<div>
                                    <h5>Rules</h5>
                                    <ul>
                                        ${r_li}
                                    </ul>
                                </div>
                                <div>
                                    <h5>Time Table</h5>
                                    <ul>
                                        ${t_li}
                                    </ul>
                                </div>`;

                $('footer').empty();
                $('footer').append(temp_html);

            }
        }).catch(function (error) {
            alert('Error getting document: ' + error);
        });



        // 응원 버튼 클릭 이벤트
        $('.btn-cheer').click(function () {
            let ck_box = $('input:checkbox[id="cheer_up"]');
            let docRef = db.collection('member_info').doc('cheer');
            let cnt = Number(cheer['cnt']); // 저장할 정수 값

            if (ck_box.is(":checked") == false) {
                cnt++;
                ck_box.attr("checked", true);
            } else {
                cnt--;
                ck_box.attr("checked", false);
            }

            cheer['cnt'] = cnt;

            docRef.set(cheer).then(function () {
                $('#cheer-count').text(cnt);
            })
                .catch(function (error) {
                    alert(error);
                });

            let temp_html = `<div id="liveToast_${cnt}_${ck_box.is(":checked")}" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    🧑‍💻&nbsp;
                    <strong class="me-auto">LISTEN24</strong>
                    <small>JUST NOW</small>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${cheer['msg'][`${ck_box.is(":checked")}`]}
                </div>
            </div>`;
            $('.toast-container').empty();
            $('.toast-container').append(temp_html);

            let toast = new bootstrap.Toast($(`#liveToast_${cnt}_${ck_box.is(":checked")}`));
            toast.show();

        });

    </script>
</head>

<body>
    <input type="checkbox" id="cheer_up" unselected>
    <div class="team-intro">
        <h1>LISTEN 24</h1>
        <p>여러분의 말을 경청하겠습니다.</p>
    </div>

    <div class="central-image text-center" id="team_intro">
        <div class="mt-3">
            <p>LISTEN 24를 응원해주세요!</p>
        </div>
        <button class="btn-cheer"><i class="fas fa-fire"></i> Cheer&nbsp;<span id="cheer-count">0</span></button>
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
        </div>
    </div>

    <div class="container cards">

        <div id="card_box" class="row row-cols-1 row-cols-md-3 g-4 justify-content-center">

        </div>
    </div>

    <footer>
        
    </footer>
</body>

</html>